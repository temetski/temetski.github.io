<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Project: Car Tracking for velocity measurement | Damian Dailisan </title> <meta name="author" content="Damian Dailisan"> <meta name="description" content="" a cornucopia of code used for physics classes.> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.jpeg?645879979159fc2c9e547880872ce470"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="http://temetski.github.io/blog/2014/project-car-tracking-for-velocity/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Damian</span> Dailisan </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Project: Car Tracking for velocity measurement</h1> <p class="post-meta"> Created on October 28, 2014 </p> <p class="post-tags"> <a href="/blog/2014"> <i class="fa-solid fa-calendar fa-sm"></i> 2014 </a>   ·   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> Python</a>   <a href="/blog/tag/image-processing"> <i class="fa-solid fa-hashtag fa-sm"></i> Image Processing</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>For my project, I want to try tracking cars in a video to determine velocities of vehicle on the road. Just a simple code with a rough estimate of velocity is what I need for now, I don’t need to match velocities to specific cars yet. But first, I need to be able to track an object across a video, which is simply a series of still images.</p> <h2 id="tracking-based-on-image-segmentation">Tracking based on Image Segmentation</h2> <p><img src="http://1.bp.blogspot.com/-37kpVVTX3VA/VFg19D7w6XI/AAAAAAAAAXA/gd51pcGPTLU/s1600/0092.png" alt=""></p> <p>We can start things of by tracking a ping-pong ball undergoing projectile motion to calculate the acceleration due to gravity. We simply converted the video to a series of images using ffmpeg as a decoder. Then we took a set of images which corresponds to one projectile motion.</p> <p><img src="http://3.bp.blogspot.com/-EExvBGS2Xws/VFg19C1VTlI/AAAAAAAAAW8/ud53uNSHDWw/s1600/roi.jpg" alt=""></p> <p>We select the ROI by color, just crop the pingpong ball. And then use Image segmentation using <a href="/blog/2014/image-segmentation/">histogram back projection</a>.</p> <p><img src="http://2.bp.blogspot.com/-712CpDx7Hns/VFg19AFXHbI/AAAAAAAAAXE/DvmFW3yeizE/s1600/back.jpg" alt=""></p> <p>Now we have a collection of points which represent the ball. We can improve the quality of our collection of points using morphological operations to clean it as well. We can get the centroid using this following snippet of code:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">IsCalculated</span> <span class="o">=</span> <span class="nc">CreateFeatureStruct</span><span class="p">(</span><span class="o">%</span><span class="n">f</span><span class="p">);</span>
<span class="n">IsCalculated</span><span class="p">.</span><span class="n">Centroid</span> <span class="o">=</span> <span class="o">%</span><span class="n">t</span><span class="p">;</span>
<span class="n">C</span> <span class="o">=</span> <span class="nc">AnalyzeBlobs</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">IsCalculated</span><span class="p">);</span>
<span class="n">Centroid</span> <span class="o">=</span> <span class="nc">C</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">Centroid</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="nc">Centroid</span><span class="p">(</span><span class="mi">2</span><span class="p">)];</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="nc">Centroid</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span></code></pre></figure> <p>Doing this for the rest of the images, we will get a collection of x and y positions, which we can plot using excel. Of course, these x and y positions need to be scaled properly, using</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">yscale</span> <span class="o">=</span> <span class="p">.</span><span class="mi">05</span><span class="o">/</span><span class="mi">20</span> <span class="o">//</span> <span class="n">meters</span> <span class="n">to</span> <span class="n">pixels</span>
<span class="n">xscale</span> <span class="o">=</span> <span class="p">.</span><span class="mi">05</span><span class="o">/</span><span class="mi">14</span> <span class="o">//</span> <span class="n">meters</span> <span class="n">to</span> <span class="n">pixels</span>
<span class="n">Y</span> <span class="o">=</span> <span class="o">-</span><span class="n">yscale</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mi">240</span><span class="p">);</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">xscale</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">);</span></code></pre></figure> <p>If we fit a second order polynomial to the y positions and time, we should get</p> <p><img src="http://1.bp.blogspot.com/-84kfWpIKTwA/VFg6UgfC0HI/AAAAAAAAAXY/eew52qeaFlM/s1600/color.png" alt=""></p> <p>The term $-4.8871$ is actually $-\frac{g}{2}$. Hence, we have $g=9.77\,\frac{m}{s^2}$.</p> <h2 id="tracking-based-on-image-difference">Tracking Based on Image Difference</h2> <p>Vehicles will not always have the same color on the road. The method of image segmentation is good, but we need something more robust if we want to be able to make a generic car velocity estimator just by video processing. A possible alternative method is using image difference. We need an image of just the background.</p> <p><img src="http://4.bp.blogspot.com/-OgHTmJvfy7M/VFg7v5kP7oI/AAAAAAAAAXk/smnZ2krxTJ8/s1600/bg.jpg" alt=""></p> <p>Then we take the difference of every frame with this frame. To binarize the difference , we set a threshold value, which will determine if pixels in the difference will be black or white.</p> <p>We’ll get another blob, from which we can get its position using centroids. We can get the following graph below:</p> <p><img src="http://1.bp.blogspot.com/-0eZgnGVw4lQ/VGq-yLZQyFI/AAAAAAAAAX0/zWEYFrxgEyk/s1600/graph.png" alt=""></p> <p>The term $-4.8871$ is actually $-\frac{g}{2}$. Hence, we have $g=9.78\,\frac{m}{s^2}$. This is a similar result as with using image segmentation by color. We are now ready to track car videos.</p> <h2 id="tracking-cars-from-a-video">Tracking cars from a video</h2> <p><img src="http://2.bp.blogspot.com/-X21Eu_daJbo/VGq-6Rx6FKI/AAAAAAAAAYA/INZwQLRsO44/s1600/fig1.jpg" alt=""></p> <p>A video frame would look like the image shown above. Since we are working with a video captured by a different person, we do not have a background that we can readily use as a reference. Instead, we utilize the difference of subsequent frames, and hope to find the outlines of the vehicles on the road. However, as shown in the next two figures, this is not as straightforward as the previous methodology of subtracting a reference background.</p> <p><img src="http://2.bp.blogspot.com/-tcvLrTyL9sU/VGq-6Az9ewI/AAAAAAAAAX8/CHPBWn1oD6s/s1600/diff.jpg" alt=""></p> <p><img src="http://3.bp.blogspot.com/-1kz2FFv-Vn4/VGq-7oOHZuI/AAAAAAAAAYU/HZjj5vt3GC0/s1600/imdiff.png" alt=""></p> <p><img src="http://2.bp.blogspot.com/-2nE8WvBfkb4/VGq-8QTDe6I/AAAAAAAAAYc/4xYRBU4GlhI/s1600/std.jpg" alt="tracks"></p> <p><img src="http://3.bp.blogspot.com/-QaViLEdy55E/VGq-6b2dsMI/AAAAAAAAAYE/CnSJQJ5PM_g/s1600/histogram.png" alt=""></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/complexity-science/">Is complexity science... science?</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/evolution-of-a-network/">Evolution of a network</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/earthquake-networks/">Earthquake Networks</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/erdos-renyi-network-metrics/">Erdos-Renyi Network Metrics</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/agent-based-models/">Agent Based Models</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Damian Dailisan. © Copyright 2025 {% site.first_name %} {% site.last_name %}. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-B7FP4W3KF7"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-B7FP4W3KF7');
  </script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>